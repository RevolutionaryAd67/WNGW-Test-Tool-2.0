<!-- HTML-Seite "Server"-->


<!-- Einbinden -->
{% extends 'base.html' %}                                           <!-- Nutzt base.html als Framework -->
{% import 'input-box/input_box.html' as input_box_component %}      <!-- Nutzt input-box als Framework -->


<!-- Seiten-spezifische Styles -->
{% block extra_css %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('component_asset', filename='input-box/input_box.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/kommunikation.css') }}">
    <style>
        .server-page {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1rem;
        }

        .server-page .input-box {
            margin: 0;
        }

        .server-page .communication {
            margin-top: 0.5rem;
        }
    </style>
{% endblock %}


<!-- Anfang: Seiteninhalt -->
{% block content %}
<div class="server-page">


    <!-- Anfang: input-Box "Kommunikationspartner (WNGW)" -->
    {% set columns = [
        {"key": "parameter", "label": "Parameter", "type": "header"},
        {"key": "value", "label": "Wert", "type": "input"}
    ] %}

    {% set rows = [
        {"id": "ip_address_wngw_server", "label": "IP-Adresse"},
        {"id": "asdu_address_wngw_server", "label": "Gemeinsame Adresse der ASDU (CA)"}
    ] %}

    {% set kommunikationspartner_box = {
        "id": "kommunikationspartner",
        "page_key": "einstellungen_server",
        "title": "Kommunikationspartner (WNGW)",
        "note": "<p>Konnektivitätsparameter des WNGW (Westnetz Gateway) für die Kommunikation mit dem Server eintragen.</p><p>Die &quot;Gemeinsame Adresse der ASDU (CA)&quot; meint die Stationsadresse des WNGW (Westnetz Gateway).</p>",
        "table": {
            "columns": columns,
            "rows": rows
        },
        "values": input_box_values("einstellungen_server", "kommunikationspartner", columns, rows)
    } %}
    <!-- Ende: input-Box "Kommunikationspartner (WNGW)" -->


    <!-- Anfang: input-Box "TCP-Konnektivität" -->
    {% set tcp_columns = [
        {"key": "parameter", "label": "Parameter", "type": "header"},
        {"key": "value", "label": "Wert", "type": "input"}
    ] %}

    {% set tcp_rows = [
        {"id": "tcp_ip_address_server", "label": "IP-Adresse"},
        {"id": "tcp_port_server", "label": "Port"}
    ] %}

    {% set tcp_konnektivitaet_box = {
        "id": "tcp_konnektivitaet",
        "page_key": "einstellungen_server",
        "title": "TCP-Konnektivität",
        "note": "<p>TCP-Konnektivitäts-Parameter, die der Server annehmen soll.</p><p>Die IP-Adresse muss in der Windows-Systemsteuerung unter Netzwerk und Internet / Netzwerk- und Freigabecenter / Adaptereinstellungen ändern / für die jeweilige Schnittstelle angepasst, mit der der Prüfrechner mit dem WNGW (Westnetz Gateway) verbunden ist.</p>",
        "table": {
            "columns": tcp_columns,
            "rows": tcp_rows
        },
        "values": input_box_values("einstellungen_server", "tcp_konnektivitaet", tcp_columns, tcp_rows)
    } %}
    <!-- Ende: input-Box "TCP-Konnektivität" -->


    <!-- Anfang: input-Box "ASDU-Parameter" -->
    {% set asdu_columns = [
        {"key": "parameter", "label": "Parameter", "type": "header"},
        {"key": "value", "label": "Wert", "type": "input"}
    ] %}

    {% set asdu_rows = [
        {"id": "asdu_common_address_server", "label": "Gemeinsame Adresse der ASDU (CA)"},
        {"id": "asdu_originator_address_server", "label": "Herkunftsadresse (HK)"}
    ] %}

    {% set asdu_parameter_box = {
        "id": "asdu_parameter",
        "page_key": "einstellungen_server",
        "title": "ASDU-Parameter",
        "note": "<p>Die &quot;Gemeinsame Adresse der ASDU (CA)&quot; meint die Stationsadresse des Servers.</p>",
        "table": {
            "columns": asdu_columns,
            "rows": asdu_rows
        },
        "values": input_box_values("einstellungen_server", "asdu_parameter", asdu_columns, asdu_rows)
    } %}
    <!-- Ende: input-Box "ASDU-Parameter" -->


    <!-- Rendern der input-boxes -->
    {{ input_box_component.render(kommunikationspartner_box) }}
    {{ input_box_component.render(tcp_konnektivitaet_box) }}
    {{ input_box_component.render(asdu_parameter_box) }}

    <section class="communication">
        <div class="communication__box">
            <header class="communication__header">
                <div>
                    <h2 class="communication__title">Signalliste hinterlegen</h2>
                    <p class="communication__subtitle">Laden Sie die vollständige Signalliste als Excel-Datei hoch.</p>
                </div>
                <div class="communication__actions">
                    <span class="communication__status" id="server-signallist-status" aria-live="polite"></span>
                    <button type="button" class="communication__save" id="server-signallist-save">Speichern</button>
                </div>
            </header>

            <div class="communication__table-wrapper">
                <table class="communication__table">
                    <thead>
                        <tr>
                            <th scope="col">Objekt</th>
                            <th scope="col">Hochladen</th>
                            <th scope="col">Datei</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th scope="row">Vollständige Signalliste</th>
                            <td>
                                <label class="file-input">
                                    <input type="file" id="server-signallist-file" accept=".xlsx">
                                    <span id="server-signallist-label">Excel-Datei auswählen</span>
                                </label>
                            </td>
                            <td><span id="server-signallist-name">–</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <p class="communication__note">
                Signalliste hinterlegen, mit der der Server (Kundensimulation) die GENERALABFRAGE_ACT im Normalbetrieb beantwortet.
            </p>
        </div>
    </section>
</div>


<!-- Ende: Seiteninhalt -->
{% endblock %}


<!-- JavaSkript einbinden -->
{% block extra_js %}
    {{ super() }}
    <script src="{{ url_for('component_asset', filename='input-box/input_box.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/server_signalliste.js') }}" defer></script>
{% endblock %}
